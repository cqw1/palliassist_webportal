{% extends "app/layout.html" %}

{% block content %}
<div class="">
    <h3>{{title}}<small><!--Subtext for header--></small></h3>
    <hr>
</div>


<!-- Search form -->
<section id="queryPatients">
<form method="GET" action="/patients/">
    {% csrf_token %}

    <!-- <div class="pa-child-display-inline-block"> -->
    <div>
        <div class="pa-child-display-inline-block">
            <label>{{ query_patients_form.patient_query.label }}</label>
            {{ query_patients_form.patient_query}}

            <button type="submit" class="btn btn-primary">Search</button>
        </div>

        {% comment %}
        <label>{{ query_patients_form.following.label }}</label>
        {{ query_patients_form.following}}
        {% endcomment %}
    </div>


</form>

</section>

<hr />


{% if patient_results %}

<!-- Table of search results --> 
<table class="table table-striped">
    <thead>
        <tr>
            <th>Name</th>
            <th>Hospital ID</th>
            <th>Gender</th>
            <th>Age</th>
            <th><!-- Add/Remove button column --></th>
        </tr>
    </thead>
    <tbody>
        <!-- Search results -->
        {% for patient_result in patient_results %}
        <tr>
            <td><a href="{% url 'patient-profile' %}?pk={{patient_result.pk}}">{{ patient_result.full_name}}</a> </td>
            <td>{{ patient_result.hospital_id}} </td>
            <td>{{ patient_result.gender }} </td>
            <td>{{ patient_result.age }} </td>

            {% if user.doctor in patient_result.doctor_set.all %}
            <td>
                <form action="/unfollow-patient" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="patient_pk" value="{{patient_result.pk}}">
                    <input type="hidden" name="doctor_pk" value="{{user.doctor.pk}}">
                    <button type="submit" class="btn btn-danger btn-xs"><span class="glyphicon glyphicon-minus"></span> Unfollow</button>
                </form>
            </td>
            {% else %}
            <td>
                <form action="/follow-patient" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="patient_pk" value="{{patient_result.pk}}">
                    <input type="hidden" name="doctor_pk" value="{{user.doctor.pk}}">
                    <button type="submit" class="btn btn-success btn-xs"><span class="glyphicon glyphicon-plus"></span> Follow</button>
                </form>
            </td>
            {% endif %}

        </tr>
        {% endfor %}
    </tbody>
</table>

{% else %}

<div class="pa-center-wrapper">
    No patients found.
</div>

{% endif %}


{% endblock %}





{% block scripts %}

{% load staticfiles %}

<script src="{% static 'app/scripts/patients.js' %}"></script>

{% endblock %}

